<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Inscription</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Icônes Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        :root{ --brand-orange:#f6a623; --brand-blue:#2E7CF6; --card-w:420px; }
        body{background:#f6f7f9;}
        .auth-wrap{min-height:100vh;display:grid;place-items:center;padding:2rem 1rem;}
        .auth-card{
          width:100%;max-width:var(--card-w);background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;
          box-shadow:0 6px 24px rgba(16,24,40,.06)
        }
        .brand-badge{display:inline-block;background:var(--brand-orange);color:#fff;font-weight:600;
          padding:.45rem 1rem;border-radius:.75rem;margin:.25rem auto 1rem}
        .btn-primary{background:var(--brand-blue);border-color:var(--brand-blue)}
        .btn-primary:hover{background:#256eea;border-color:#256eea}
        .small-muted{font-size:.875rem;color:#6c757d}
        .pw-meter{height:.375rem}

        /* + d’espace (aligné avec la page login) */
        .mb-3{margin-bottom:1.25rem!important}
        .mb-4{margin-bottom:1.5rem!important}
        .mt-4{margin-top:1.5rem!important}

        /* Form-floating dans un input-group (œil) */
        .input-group .form-floating{flex:1}
        .input-group .form-floating>.form-control{
          border-top-right-radius:0;border-bottom-right-radius:0;
          height:calc(3.5rem + 2px)
        }
        .btn-icon{
          min-width:48px; /* zone cliquable confortable */
          border-top-left-radius:0;border-bottom-left-radius:0
        }
    </style>
</head>
<body>
<main class="auth-wrap">
    <div class="auth-card p-4 p-md-5">
        <div class="text-center">
            <div class="brand-badge">Pay My Buddy</div>
        </div>

        <!-- Flash / erreurs -->
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

        <form class="needs-validation" novalidate
              th:action="@{/register}" method="post" th:object="${form}" autocomplete="off">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <!-- Username -->
            <div class="form-floating mb-4">
                <input type="text" class="form-control" id="username"
                       th:field="*{username}" placeholder="Username" />
                <label for="username">Username</label>
                <div class="invalid-feedback">Saisis un username valide.</div>
                <div class="small-muted" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
            </div>

            <!-- Email -->
            <div class="form-floating mb-4">
                <input type="email" class="form-control" id="email"
                       th:field="*{email}" placeholder="nom@domaine.com" required />
                <label for="email">Adresse e-mail</label>
                <div class="invalid-feedback">Indique une adresse e-mail valide.</div>
                <div class="small-muted" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>

            <!-- Mot de passe -->
            <div class="mb-4">
                <div class="input-group">
                    <div class="form-floating">
                        <input type="password" class="form-control" id="password"
                               th:field="*{password}" placeholder="Mot de passe" minlength="8" required />
                        <label for="password">Mot de passe</label>
                    </div>
                    <button type="button" class="btn btn-outline-secondary btn-icon" id="togglePwd"
                            aria-label="Afficher le mot de passe" aria-pressed="false">
                        <i class="bi bi-eye"></i>
                    </button>
                </div>
                <div class="progress pw-meter mt-2">
                    <div id="pwStrength" class="progress-bar" role="progressbar" style="width:0%"></div>
                </div>
                <div class="small-muted mt-1">8+ caractères, idéalement avec majuscules, chiffres et symbole.</div>
                <div class="invalid-feedback d-block" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
            </div>

            <!-- Confirmation -->
            <div class="input-group mb-4">
                <div class="form-floating">
                    <input type="password" class="form-control" id="confirmPassword"
                           th:field="*{confirmPassword}" placeholder="Confirmer" required />
                    <label for="confirmPassword">Confirmer le mot de passe</label>
                    <div class="invalid-feedback">Les mots de passe doivent correspondre.</div>
                </div>
                <button type="button" class="btn btn-outline-secondary btn-icon" id="toggleConfirm"
                        aria-label="Afficher le mot de passe" aria-pressed="false">
                    <i class="bi bi-eye"></i>
                </button>
            </div>
            <div class="small-muted" th:if="${#fields.hasErrors('confirmPassword')}" th:errors="*{confirmPassword}"></div>

            <button class="btn btn-primary w-100 py-2" type="submit">S’inscrire</button>

            <p class="text-center mt-4 mb-0 small-muted">
                Déjà un compte ? <a th:href="@{/login}">Se connecter</a>
            </p>
        </form>
    </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Validation Bootstrap + correspondance des mots de passe
    (()=>{const f=document.querySelector('form.needs-validation');
      f.addEventListener('submit',e=>{
        const p=document.getElementById('password');
        const c=document.getElementById('confirmPassword');
        c.setCustomValidity(p.value!==c.value ? 'Mismatch' : '');
        if(!f.checkValidity()){e.preventDefault();e.stopPropagation()}
        f.classList.add('was-validated');
      },false);
    })();

    // Afficher/Masquer password + switch icône
    function bindToggle(buttonId, inputId){
      const btn = document.getElementById(buttonId);
      const icon = btn.querySelector('i');
      const input = document.getElementById(inputId);
      btn.addEventListener('click',()=>{
        const show = input.type === 'password';
        input.type = show ? 'text' : 'password';
        btn.setAttribute('aria-pressed', show ? 'true' : 'false');
        btn.setAttribute('aria-label', show ? 'Masquer le mot de passe' : 'Afficher le mot de passe');
        icon.classList.toggle('bi-eye', !show);
        icon.classList.toggle('bi-eye-slash', show);
      });
    }
    bindToggle('togglePwd','password');
    bindToggle('toggleConfirm','confirmPassword');

    // Simple strength meter
    const pw=document.getElementById('password');
    const bar=document.getElementById('pwStrength');
    pw.addEventListener('input',()=>{
      const v=pw.value;
      let s=0;
      if(v.length>=8) s++;
      if(/[A-Z]/.test(v)) s++;
      if(/[0-9]/.test(v)) s++;
      if(/[^A-Za-z0-9]/.test(v)) s++;
      const pct=[0,25,50,75,100][s];
      bar.style.width=pct+'%';
      bar.className='progress-bar';
      if(pct>=75) bar.classList.add('bg-success');
      else if(pct>=50) bar.classList.add('bg-info');
      else if(pct>=25) bar.classList.add('bg-warning');
      else bar.classList.add('bg-danger');
    });
</script>
</body>
</html>
